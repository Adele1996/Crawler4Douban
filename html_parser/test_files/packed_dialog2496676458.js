(function(){var C=8;var z=window.dui||{},e="dui-dialog",w=[],s=null,f=($.browser.msie&&$.browser.version==="6.0")?true:false,d={},r={},B="j_close_dialog",b="dui-dialog",m="dui-dialog-close",a="dui-dialog-shd",q="dui-dialog-content",n="dui-dialog-iframe",j="dui-dialog-msk",p="确定",c="取消",v="提示",l="下载中，请稍候...",i='<div id="{ID}" class="'+b+' {CLS}" style="{CSS_ISHIDE}">                <span class="'+a+'"></span>                <div class="'+q+'">                    {BN_CLOSE}                    {TITLE}                    <div class="bd">{BODY}</div>                </div>            </div>',g='<a href="#" class="'+B+" "+m+'">X</a>',k='<div class="hd"><h3>{TITLE}</h3></div>',x='<iframe class="'+n+'"></iframe>',t='<div class="'+j+'"></div>',o={confirm:{text:p,method:function(D){D.close()}},cancel:{text:c,method:function(D){D.close()}}},A={url:"",nodeId:"",cls:"",content:"",title:v,width:0,height:0,visible:false,modal:false,iframe:false,maxWidth:960,autoupdate:false,cache:true,buttons:[],callback:null,dataType:"text",isStick:false,isHideClose:false,isHideTitle:false},h=function(G,F){var D={},E;for(E in F){if(F.hasOwnProperty(E)){D[E]=G[E]||F[E]}}return D},y=function(I){var F=I.elements,E=0,G,H=[],D={"select-one":function(J){return encodeURIComponent(J.name)+"="+encodeURIComponent(J.options[J.selectedIndex].value)},"select-multiple":function(M){var L=0,K,J=[];for(;K=M.options[L++];){if(K.selected){J.push(encodeURIComponent(M.name)+"="+encodeURIComponent(K.value))}}return J.join("&")},radio:function(J){if(J.checked){return encodeURIComponent(J.name)+"="+encodeURIComponent(J.value)}},checkbox:function(J){if(J.checked){return encodeURIComponent(J.name)+"="+encodeURIComponent(J.value)}}};for(;G=F[E++];){if(D[G.type]){H.push(D[G.type](G))}else{H.push(encodeURIComponent(G.name)+"="+encodeURIComponent(G.value))}}return H.join("&").replace(/\&{2,}/g,"&")},u=function(D){var E=D||{};this.config=h(E,A);this.init()};u.prototype={init:function(){if(!this.config){return}this.render();this.bind();return this},render:function(G){var D=this.config,I=D.nodeId||e+w.length;w.push(I);var F=$("body"),H=F.find("."+j),E=typeof D.content==="object"?$(D.content).html():D.content;F.append(i.replace("{ID}",I).replace("{CSS_ISHIDE}",D.visible?"":"visibility:hidden;top:-999em;left:-999em;").replace("{CLS}",D.cls).replace("{TITLE}",k.replace("{TITLE}",D.title)).replace("{BN_CLOSE}",g).replace("{BODY}",E||G||""));if(D.modal&&!H.length){F.append(t);this.msk=$("."+j)}else{this.msk=H.eq(0)}this.nodeId=I;this.node=$("#"+I);this.title=$(".hd",this.node);this.body=$(".bd",this.node);this.btnClose=$("."+m,this.node);this.shadow=$("."+a,this.node);this.iframe=$("."+n,this.node);this.set(D);return this},bind:function(){var D=this;$(window).bind({resize:function(){if(f){return}D.updatePosition()},scroll:function(){if(!f){return}D.updatePosition()}});D.node.delegate("."+B,"click",function(E){D.close();E.preventDefault()});D.node.find("."+m).bind("click",function(E){D.close();E.preventDefault()});$("body").keypress(function(E){if(E.keyCode===27){D.close()}});return this},updateSize:function(){var F=this.node.width(),G,D=$(window).width(),H=$(window).height(),E=this.config;$(".bd",this.node).css({height:"auto","overflow-x":"visible","overflow-y":"visible"});G=this.node.height();var I=2*C;E.maxWidth=Math.min(E.maxWidth,D-I);if(F>E.maxWidth){F=E.maxWidth;this.node.css("width",F+"px")}if(G>H){$(".bd",this.node).css({height:(H-150)+"px","overflow-x":"hidden","overflow-y":"auto"})}G=this.node.height();this.shadow.width(F);this.shadow.height(G);this.iframe.width(F+I).height(G+I);return this},updatePosition:function(){if(this.config.isStick){return}var D=this.node.width(),F=this.node.height(),G=$(window),E=f?G.scrollTop():0;this.node.css({left:Math.floor(G.width()/2-D/2)+"px",top:Math.floor(G.height()/2-F/2-C)+E+"px"});return this},set:function(I){var K,N,E,F,D=this.nodeId,L=this.nodeId||L,G=[],H=this,M=function(O){G.push(0);return D+"-"+O+"-"+G.length};if(!I){return this}if(I.width){this.node.css("width",I.width+"px");this.config.width=I.width}if(I.height){this.node.css("height",I.height+"px");this.config.height=I.height}if($.isArray(I.buttons)&&I.buttons[0]){F=$(".ft",this.node);E=[];$(I.buttons).each(function(){var P=arguments[1],O=M("bn");if(typeof P==="string"){P=o[P]}if(!P.text){return}if(P.href){E.push('<a class="'+(P.cls||"")+'" id="'+O+'" href="'+P.href+'">'+P.text+"</a> ")}else{E.push('<span class="bn-flat '+(P.cls||"")+'"><input type="button" id="'+O+'" class="'+L+'-bn" value="'+P.text+'" /></span> ')}r[O]=P.method});if(!F[0]){F=this.body.parent().append('<div class="ft">'+E.join("")+"</div>")}else{F.html(E.join(""))}this.footer=$(".ft",this.node);$(".ft input, .ft a",this.node).click(function(Q){var P=this.id&&r[this.id];if(P){var O=P.call(this,H)}if(O){Q.preventDefault();if(typeof O=="string"){alert(O)}}})}else{this.footer=$(".ft",this.node);this.footer.html("")}if(typeof I.isHideClose!=="undefined"){if(I.isHideClose){this.btnClose.hide()}else{this.btnClose.show()}this.config.isHideClose=I.isHideClose}if(typeof I.isHideTitle!=="undefined"){if(I.isHideTitle){this.title.hide()}else{this.title.show()}this.config.isHideTitle=I.isHideTitle}if(I.title){this.setTitle(I.title);this.config.title=I.title}if(typeof I.iframe!=="undefined"){if(!I.iframe){this.iframe.hide()}else{if(!this.iframe[0]){this.node.prepend(x);this.iframe=$("."+n,this.node)}else{this.iframe.show()}}this.config.iframe=I.iframe}if(I.content){this.body.html(typeof I.content==="object"?$(I.content).html():I.content);this.config.content=I.content}if(I.url){if(I.cache&&d[I.url]){if(I.dataType==="text"||!I.dataType){this.setContent(d[I.url])}if(I.callback){I.callback(d[I.url],this)}}else{if(I.dataType==="json"){this.setContent(l);if(this.footer){this.footer.hide()}$.getJSON(I.url,function(O){H.footer.show();d[I.url]=O;if(I.callback){I.callback(O,H)}})}else{this.setContent(l);if(this.footer){this.footer.hide()}$.ajax({url:I.url,dataType:I.dataType,success:function(O){d[I.url]=O;if(H.footer){H.footer.show()}H.setContent(O);if(I.callback){I.callback(O,H)}}})}}}var J=I.position;if(J){this.node.css({left:J[0]+"px",top:J[1]+"px"})}if(typeof I.autoupdate==="boolean"){this.config.autoupdate=I.autoupdate}if(typeof I.isStick==="boolean"){if(I.isStick){this.node.css("position","absolute")}else{this.node.css("position","fixed")}this.config.isStick=I.isStick}return this.update()},update:function(){this.updateSize();this.updatePosition();return this},setContent:function(D){this.body.html(D);return this.update()},setTitle:function(D){$("h3",this.title).html(D);return this},submit:function(F){var D=this,E=$("form",this.node);E.submit(function(J){J.preventDefault();var G=this.getAttribute("action",2),H=this.getAttribute("method")||"get",I=y(this);$[H.toLowerCase()](G,I,function(K){if(F){F(K)}},"json")});E.submit()},open:function(){this.node.appendTo("body").css("visibility","visible").show();var E=this,D=this.config,F=E.body[0];E.contentHeight=F.offsetHeight;this.watcher=!D.autoupdate?0:setInterval(function(){if(F.offsetHeight===E.contentHeight){return}E.update();E.contentHeight=F.offsetHeight},100);if(D.modal){this.msk.show().css({height:$(document).height()})}return this},close:function(){this.node.hide();this.msk.hide();this.node.trigger("dialog:close",this);clearInterval(this.watcher);return this}};z.Dialog=function(D,E){if(!E&&s){return D?s.set(D):s}if(!s&&!E){s=new u(D);return s}return new u(D)};window.dui=z})();